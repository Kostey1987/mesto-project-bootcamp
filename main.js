(()=>{"use strict";var e={};function t(e){e.disabled=!0}function n(e,n){e.checkValidity()?function(e){e.disabled=!1}(n):t(n)}e.p="";var r=document.querySelectorAll(".popup"),o=document.querySelectorAll(".popup__close-button"),c=document.querySelector(".popup__image"),a=document.querySelector(".popup__paragraph");function u(e){"Escape"===e.key&&l(document.querySelector(".popup_opened"))}function i(e){e.classList.add("popup_opened"),document.addEventListener("keydown",u)}function l(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",u)}r.forEach((function(e){e.addEventListener("mousedown",(function(e){e.target.classList.contains("popup")&&l(e.target)}))})),o.forEach((function(e){e.addEventListener("click",(function(e){l(e.target.closest(".popup"))}))}));var s={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-13",headers:{authorization:"134a69fe-36da-4a83-9e66-486fbf5e8446","Content-Type":"application/json"}};function d(e){return e.ok?e.json():e.json().then((function(t){t.status=e.status,Promise.reject(t)}))}console.log("".concat(s.baseUrl,"/cards"));var p=void 0;function f(){return p}var m=document.querySelector(".cards"),_=document.querySelector(".popup-image"),h=document.querySelector("#create-item").content;function v(e,t){e.textContent=t}function y(e){var t=h.querySelector(".card").cloneNode(!0),n=t.querySelector(".card__image");t.id=e._id,n.src=e.link,n.alt=e.name,t.querySelector(".card__paragraph").textContent=e.name;var r=t.querySelector(".card__trash");f()!==e.owner._id?r.remove():r.addEventListener("click",(function(){return n=t,r=e._id,void(o=r,fetch("".concat(s.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:s.headers}).then(d)).then((function(){n.remove()})).catch((function(e){return console.log(e.status,e.mesage)}));var n,r,o}));var o=t.querySelector(".card__likeСount");o.textContent=e.likes.length;var u=e.likes.length,l=t.querySelector(".card__like");return function(e,t){return e.some((function(e){return e._id===t&&console.log(e),e._id===t}))}(e.likes,f())&&l.classList.add("card__like_active"),l.addEventListener("click",(function(t){var n;t.target.classList.contains("card__like_active")?(n=e._id,fetch("".concat(s.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:s.headers}).then(d)).then((function(e){t.target.classList.toggle("card__like_active"),u=e.likes.length,v(o,u)})).catch((function(e){return console.log(e.status,e.message)})):function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:s.headers}).then(d)}(e._id).then((function(e){t.target.classList.toggle("card__like_active"),u=e.likes.length,v(o,u)})).catch((function(e){return console.log(e.status,e.message)}))})),n.addEventListener("click",(function(){var t,n;t=e.name,n=e.link,c.src=n,c.alt=t,a.textContent=t,i(_)})),t}function g(e){m.prepend(e)}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p;var b=document.querySelector(".profile__add-button"),q=document.querySelector(".popup-card"),E=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup-profile"),L=document.querySelector(".popup__form_card"),C=document.querySelector(".popup__form_profile"),x=document.querySelector(".popup__input_name"),A=document.querySelector(".popup__input_job-title"),U=document.querySelector(".profile__name"),I=document.querySelector(".profile__about"),j=document.querySelector(".popup__input_place"),w=document.querySelector(".popup__input_image"),O=document.getElementById("submitCard"),T=document.getElementById("submitProfile"),B=document.getElementById("submitAvatar"),P=document.querySelector(".popup-avatar"),D=document.querySelector(".profile__avatar"),N=document.querySelector(".profile__avatar-button"),J=document.querySelector(".popup__input_avatar");Promise.all([fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then(d),fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then(d)]).then((function(e){var t,n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(n,r)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];t=c._id,p=t,console.log(c._id),z(c),H(c),a.reverse().forEach((function(e){g(y(e))}))})).catch((function(e){console.log(e)})),N.addEventListener("click",(function(){i(P)}));var H=function(e){D.src=e.avatar};P.addEventListener("submit",(function(e){var n;e.preventDefault(),B.textContent="Сохранение...",(n=J.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:n})}).then(d)).then((function(n){H(n),e.target.reset(),t(B),l(P)})).catch((function(e){return console.log(e.status,e.mesage)})).finally((function(){B.textContent="Сохранить"}))})),E.addEventListener("click",(function(){x.value=U.textContent,A.value=I.textContent,i(k),t(T)})),b.addEventListener("click",(function(){i(q),t(O)}));var M,z=function(e){U.textContent=e.name,I.textContent=e.about};C.addEventListener("submit",(function(e){var t,n;e.preventDefault(),T.textContent="Сохранение...",(t=x.value,n=A.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:n})}).then(d)).then((function(e){z(e),l(k)})).catch((function(e){return console.log(e.status,e.mesage)})).finally((function(){T.textContent="Сохранить"}))})),L.addEventListener("submit",(function(e){var t,n;e.preventDefault(),O.textContent="Сохранение...",(t=j.value,n=w.value,fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers,method:"POST",body:JSON.stringify({name:t,link:n})}).then(d)).then((function(t){g(y(t)),e.target.reset(),l(q)})).catch((function(e){return console.log(e.status,e.mesage)})).finally((function(){O.textContent="Создать"}))})),M={inputSelector:".popup__input",submitButtonSelector:".popup__submit",formSelector:".popup__form",errorInputClass:"popup__input_error"},document.querySelectorAll(M.formSelector).forEach((function(e){var t=e.querySelector(M.submitButtonSelector),r=e.querySelectorAll(M.inputSelector);n(e,t),r.forEach((function(r){r.addEventListener("input",(function(){n(e,t),function(e,t){e.validity.valid?function(e,t){var n="error-"+e.id,r=document.getElementById(n);e.classList.remove(t),r.textContent=""}(e,t.errorInputClass):function(e,t,n){var r="error-"+e.id,o=document.getElementById(r);e.classList.add(n),o.textContent=t}(e,e.validationMessage,t.errorInputClass)}(r,M)}))}))}))})();